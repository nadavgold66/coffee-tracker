<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Coffee Tracker Pro</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-storage-compat.js"></script>
    <style>
        .slider {
            -webkit-appearance: none;
            appearance: none;
            height: 8px;
            background: #e5e7eb;
            outline: none;
            opacity: 0.7;
            transition: opacity 0.2s;
        }
        .slider:hover {
            opacity: 1;
        }
        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: #6b4423;
            cursor: pointer;
            border-radius: 50%;
        }
        .slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background: #6b4423;
            cursor: pointer;
            border-radius: 50%;
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDMhpNWUEJKLQtLBMW4sxwUI9hNQPNKxyU",
            authDomain: "coffee-tracker-app-321aa.firebaseapp.com",
            projectId: "coffee-tracker-app-321aa",
            storageBucket: "coffee-tracker-app-321aa.firebasestorage.app",
            messagingSenderId: "420921255039",
            appId: "1:420921255039:web:b10250998e91b1df5b8b4a"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        const storage = firebase.storage();

        const { useState, useEffect, useRef } = React;

        // Rating categories
        const RATING_CATEGORIES = [
            'taste', 'aroma', 'acidity', 'body', 'aftertaste', 'strength'
        ];

        const BREW_METHODS = [
            'French Press', 'Espresso', 'Moka Pot', 'Cold Brew', 
            'Pour Over', 'Aeropress', 'Turkish', 'Other'
        ];

        const ROAST_LEVELS = ['Light', 'Medium', 'Dark'];

        // Auth Component
        function AuthComponent({ onAuthStateChanged }) {
            const [user, setUser] = useState(null);
            const [loading, setLoading] = useState(true);

            useEffect(() => {
                const unsubscribe = auth.onAuthStateChanged((user) => {
                    setUser(user);
                    setLoading(false);
                    onAuthStateChanged(user);
                });
                return unsubscribe;
            }, []);

            const signInWithGoogle = async () => {
                const provider = new firebase.auth.GoogleAuthProvider();
                try {
                    await auth.signInWithPopup(provider);
                } catch (error) {
                    console.error("Error signing in:", error);
                }
            };

            const signOut = async () => {
                try {
                    await auth.signOut();
                } catch (error) {
                    console.error("Error signing out:", error);
                }
            };

            if (loading) {
                return (
                    <div className="min-h-screen bg-amber-50 flex items-center justify-center">
                        <div className="text-2xl text-amber-800">Loading...</div>
                    </div>
                );
            }

            if (!user) {
                return (
                    <div className="min-h-screen bg-amber-50 flex items-center justify-center">
                        <div className="bg-white p-8 rounded-lg shadow-lg max-w-md w-full">
                            <h1 className="text-3xl font-bold text-amber-900 mb-6 text-center">☕ Coffee Tracker Pro</h1>
                            <p className="text-gray-600 mb-6 text-center">Track and compare your favorite coffees</p>
                            <button
                                onClick={signInWithGoogle}
                                className="w-full bg-amber-600 text-white py-3 px-4 rounded-lg hover:bg-amber-700 transition duration-200 font-semibold"
                            >
                                Sign in with Google
                            </button>
                        </div>
                    </div>
                );
            }

            return (
                <div className="bg-amber-900 text-white p-4">
                    <div className="max-w-7xl mx-auto flex justify-between items-center">
                        <h1 className="text-2xl font-bold">☕ Coffee Tracker Pro</h1>
                        <div className="flex items-center space-x-4">
                            <span className="text-sm">{user.displayName}</span>
                            <img src={user.photoURL} alt="Profile" className="w-8 h-8 rounded-full" />
                            <button
                                onClick={signOut}
                                className="bg-amber-700 px-4 py-2 rounded hover:bg-amber-800 transition"
                            >
                                Sign Out
                            </button>
                        </div>
                    </div>
                </div>
            );
        }

        // Main App Component
        function CoffeeTrackerApp() {
            const [user, setUser] = useState(null);
            const [coffees, setCoffees] = useState([]);
            const [showAddForm, setShowAddForm] = useState(false);
            const [editingCoffee, setEditingCoffee] = useState(null);
            const [compareMode, setCompareMode] = useState(false);
            const [selectedForCompare, setSelectedForCompare] = useState([]);
            const [filterMethod, setFilterMethod] = useState('all');
            const [sortBy, setSortBy] = useState('dateAdded');

            useEffect(() => {
                if (user) {
                    const unsubscribe = db.collection('users').doc(user.uid)
                        .collection('coffees')
                        .orderBy('dateAdded', 'desc')
                        .onSnapshot((snapshot) => {
                            const coffeesData = snapshot.docs.map(doc => ({
                                id: doc.id,
                                ...doc.data()
                            }));
                            setCoffees(coffeesData);
                        });
                    return unsubscribe;
                }
            }, [user]);

            const handleAuthStateChanged = (user) => {
                setUser(user);
            };

            const calculateAverageRating = (coffee) => {
                let totalRating = 0;
                let totalCount = 0;

                if (coffee.brewMethods) {
                    Object.values(coffee.brewMethods).forEach(method => {
                        RATING_CATEGORIES.forEach(category => {
                            if (method[category]) {
                                totalRating += method[category];
                                totalCount++;
                            }
                        });
                    });
                }

                return totalCount > 0 ? (totalRating / totalCount).toFixed(1) : 0;
            };

            const handleDelete = async (coffeeId) => {
                if (window.confirm('Are you sure you want to delete this coffee?')) {
                    try {
                        await db.collection('users').doc(user.uid)
                            .collection('coffees').doc(coffeeId).delete();
                    } catch (error) {
                        console.error("Error deleting coffee:", error);
                    }
                }
            };

            const filteredAndSortedCoffees = coffees
                .filter(coffee => {
                    if (filterMethod === 'all') return true;
                    return coffee.brewMethods && coffee.brewMethods[filterMethod];
                })
                .sort((a, b) => {
                    switch (sortBy) {
                        case 'rating':
                            return calculateAverageRating(b) - calculateAverageRating(a);
                        case 'name':
                            return a.name.localeCompare(b.name);
                        case 'dateAdded':
                        default:
                            return b.dateAdded - a.dateAdded;
                    }
                });

            return (
                <div className="min-h-screen bg-amber-50">
                    <AuthComponent onAuthStateChanged={handleAuthStateChanged} />
                    
                    {user && (
                        <div className="max-w-7xl mx-auto p-4">
                            {/* Action Bar */}
                            <div className="bg-white rounded-lg shadow-md p-4 mb-6">
                                <div className="flex flex-wrap gap-4 justify-between items-center">
                                    <div className="flex gap-2">
                                        <button
                                            onClick={() => setShowAddForm(true)}
                                            className="bg-amber-600 text-white px-4 py-2 rounded hover:bg-amber-700 transition"
                                        >
                                            + Add Coffee
                                        </button>
                                        <button
                                            onClick={() => {
                                                setCompareMode(!compareMode);
                                                setSelectedForCompare([]);
                                            }}
                                            className={`px-4 py-2 rounded transition ${
                                                compareMode 
                                                    ? 'bg-red-600 text-white hover:bg-red-700' 
                                                    : 'bg-gray-600 text-white hover:bg-gray-700'
                                            }`}
                                        >
                                            {compareMode ? 'Cancel Compare' : 'Compare'}
                                        </button>
                                    </div>
                                    
                                    <div className="flex gap-2">
                                        <select
                                            value={filterMethod}
                                            onChange={(e) => setFilterMethod(e.target.value)}
                                            className="border rounded px-3 py-2"
                                        >
                                            <option value="all">All Methods</option>
                                            {BREW_METHODS.map(method => (
                                                <option key={method} value={method}>{method}</option>
                                            ))}
                                        </select>
                                        
                                        <select
                                            value={sortBy}
                                            onChange={(e) => setSortBy(e.target.value)}
                                            className="border rounded px-3 py-2"
                                        >
                                            <option value="dateAdded">Date Added</option>
                                            <option value="rating">Rating</option>
                                            <option value="name">Name</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            {/* Compare Mode */}
                            {compareMode && selectedForCompare.length === 2 && (
                                <CompareView 
                                    coffee1={coffees.find(c => c.id === selectedForCompare[0])}
                                    coffee2={coffees.find(c => c.id === selectedForCompare[1])}
                                    onClose={() => {
                                        setCompareMode(false);
                                        setSelectedForCompare([]);
                                    }}
                                />
                            )}

                            {/* Coffee Grid */}
                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                {filteredAndSortedCoffees.map(coffee => (
                                    <CoffeeCard
                                        key={coffee.id}
                                        coffee={coffee}
                                        onEdit={() => setEditingCoffee(coffee)}
                                        onDelete={() => handleDelete(coffee.id)}
                                        compareMode={compareMode}
                                        isSelected={selectedForCompare.includes(coffee.id)}
                                        onToggleSelect={(id) => {
                                            if (selectedForCompare.includes(id)) {
                                                setSelectedForCompare(selectedForCompare.filter(i => i !== id));
                                            } else if (selectedForCompare.length < 2) {
                                                setSelectedForCompare([...selectedForCompare, id]);
                                            }
                                        }}
                                        averageRating={calculateAverageRating(coffee)}
                                    />
                                ))}
                            </div>

                            {coffees.length === 0 && (
                                <div className="text-center py-12">
                                    <p className="text-gray-500 text-lg">No coffees added yet. Add your first coffee!</p>
                                </div>
                            )}

                            {/* Add/Edit Form Modal */}
                            {(showAddForm || editingCoffee) && (
                                <CoffeeForm
                                    user={user}
                                    coffee={editingCoffee}
                                    onClose={() => {
                                        setShowAddForm(false);
                                        setEditingCoffee(null);
                                    }}
                                />
                            )}
                        </div>
                    )}
                </div>
            );
        }

        // Coffee Card Component
        function CoffeeCard({ coffee, onEdit, onDelete, compareMode, isSelected, onToggleSelect, averageRating }) {
            const [expandedMethod, setExpandedMethod] = useState(null);

            return (
                <div className={`bg-white rounded-lg shadow-md overflow-hidden ${
                    compareMode && isSelected ? 'ring-4 ring-amber-500' : ''
                }`}>
                    {compareMode && (
                        <div className="p-2 bg-gray-100">
                            <label className="flex items-center space-x-2">
                                <input
                                    type="checkbox"
                                    checked={isSelected}
                                    onChange={() => onToggleSelect(coffee.id)}
                                    className="w-4 h-4"
                                />
                                <span className="text-sm">Select for comparison</span>
                            </label>
                        </div>
                    )}
                    
                    <div className="aspect-w-16 aspect-h-9 bg-gray-200">
                        {coffee.imageUrl ? (
                            <img 
                                src={coffee.imageUrl} 
                                alt={coffee.name}
                                className="w-full h-48 object-cover"
                            />
                        ) : (
                            <div className="w-full h-48 flex items-center justify-center text-gray-400">
                                <span className="text-6xl">☕</span>
                            </div>
                        )}
                    </div>
                    
                    <div className="p-4">
                        <h3 className="text-xl font-semibold text-gray-800">{coffee.name}</h3>
                        <p className="text-gray-600">{coffee.brand}</p>
                        <p className="text-sm text-gray-500">{coffee.origin} • {coffee.roastLevel}</p>
                        
                        <div className="mt-2 flex items-center">
                            <div className="text-yellow-500">
                                {'★'.repeat(Math.round(averageRating / 2))}
                                {'☆'.repeat(5 - Math.round(averageRating / 2))}
                            </div>
                            <span className="ml-2 text-gray-600">{averageRating}/10</span>
                        </div>
                        
                        {coffee.brewMethods && (
                            <div className="mt-3">
                                <p className="text-sm text-gray-600 mb-2">
                                    Brew Methods: {Object.keys(coffee.brewMethods).length}
                                </p>
                                {Object.entries(coffee.brewMethods).map(([method, ratings]) => (
                                    <div key={method} className="mb-2">
                                        <button
                                            onClick={() => setExpandedMethod(expandedMethod === method ? null : method)}
                                            className="text-sm text-amber-700 hover:text-amber-900 font-medium"
                                        >
                                            {method} ▸
                                        </button>
                                        {expandedMethod === method && (
                                            <div className="mt-2 p-2 bg-gray-50 rounded text-sm">
                                                {RATING_CATEGORIES.map(cat => (
                                                    <div key={cat} className="flex justify-between">
                                                        <span className="capitalize">{cat}:</span>
                                                        <span>{ratings[cat] || 0}/10</span>
                                                    </div>
                                                ))}
                                            </div>
                                        )}
                                    </div>
                                ))}
                            </div>
                        )}
                        
                        <div className="mt-4 flex gap-2">
                            <button
                                onClick={onEdit}
                                className="flex-1 bg-amber-600 text-white py-1 px-3 rounded text-sm hover:bg-amber-700 transition"
                            >
                                Edit
                            </button>
                            <button
                                onClick={onDelete}
                                className="bg-red-600 text-white py-1 px-3 rounded text-sm hover:bg-red-700 transition"
                            >
                                Delete
                            </button>
                            {coffee.orderLink && (
                                <a
                                    href={coffee.orderLink}
                                    target="_blank"
                                    rel="noopener noreferrer"
                                    className="bg-green-600 text-white py-1 px-3 rounded text-sm hover:bg-green-700 transition"
                                >
                                    Order
                                </a>
                            )}
                        </div>
                    </div>
                </div>
            );
        }

        // Coffee Form Component
        function CoffeeForm({ user, coffee, onClose }) {
            const [formData, setFormData] = useState({
                name: '',
                brand: '',
                origin: '',
                roastLevel: 'Medium',
                roastingDate: '',
                grindingLevel: '',
                price: '',
                orderLink: '',
                notes: '',
                imageUrl: '',
                brewMethods: {},
                ...coffee
            });
            const [currentMethod, setCurrentMethod] = useState('French Press');
            const [currentRatings, setCurrentRatings] = useState({
                taste: 5,
                aroma: 5,
                acidity: 5,
                body: 5,
                aftertaste: 5,
                strength: 5
            });
            const [uploading, setUploading] = useState(false);
            const fileInputRef = useRef(null);

            const handleImageUpload = async (e) => {
                const file = e.target.files[0];
                if (!file) return;

                setUploading(true);
                try {
                    const storageRef = storage.ref();
                    const fileRef = storageRef.child(`coffee-images/${user.uid}/${Date.now()}_${file.name}`);
                    await fileRef.put(file);
                    const imageUrl = await fileRef.getDownloadURL();
                    setFormData({ ...formData, imageUrl });
                } catch (error) {
                    console.error("Error uploading image:", error);
                    alert("Failed to upload image");
                } finally {
                    setUploading(false);
                }
            };

            const handleAddBrewMethod = () => {
                if (!formData.brewMethods[currentMethod]) {
                    setFormData({
                        ...formData,
                        brewMethods: {
                            ...formData.brewMethods,
                            [currentMethod]: currentRatings
                        }
                    });
                }
            };

            const handleRemoveBrewMethod = (method) => {
                const newMethods = { ...formData.brewMethods };
                delete newMethods[method];
                setFormData({ ...formData, brewMethods: newMethods });
            };

            const handleSubmit = async (e) => {
                e.preventDefault();
                
                if (!formData.name || !formData.brand) {
                    alert('Please fill in at least the coffee name and brand');
                    return;
                }

                try {
                    const coffeeData = {
                        ...formData,
                        dateAdded: coffee ? formData.dateAdded : Date.now(),
                        lastModified: Date.now()
                    };

                    if (coffee) {
                        await db.collection('users').doc(user.uid)
                            .collection('coffees').doc(coffee.id).update(coffeeData);
                    } else {
                        await db.collection('users').doc(user.uid)
                            .collection('coffees').add(coffeeData);
                    }
                    onClose();
                } catch (error) {
                    console.error("Error saving coffee:", error);
                    alert("Failed to save coffee");
                }
            };

            return (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 overflow-y-auto">
                    <div className="bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
                        <div className="p-6">
                            <h2 className="text-2xl font-bold mb-4">
                                {coffee ? 'Edit Coffee' : 'Add New Coffee'}
                            </h2>
                            
                            <form onSubmit={handleSubmit}>
                                {/* Image Upload */}
                                <div className="mb-4">
                                    <label className="block text-sm font-medium mb-2">Coffee Photo</label>
                                    <div className="flex items-center gap-4">
                                        {formData.imageUrl && (
                                            <img 
                                                src={formData.imageUrl} 
                                                alt="Coffee" 
                                                className="w-32 h-32 object-cover rounded"
                                            />
                                        )}
                                        <div>
                                            <input
                                                ref={fileInputRef}
                                                type="file"
                                                accept="image/*"
                                                capture="environment"
                                                onChange={handleImageUpload}
                                                className="hidden"
                                            />
                                            <button
                                                type="button"
                                                onClick={() => fileInputRef.current.click()}
                                                disabled={uploading}
                                                className="bg-gray-600 text-white px-4 py-2 rounded hover:bg-gray-700 transition disabled:opacity-50"
                                            >
                                                {uploading ? 'Uploading...' : 'Upload Photo'}
                                            </button>
                                            <label className="text-sm text-gray-600 ml-2">
                                                {/iPhone|iPad|Android/i.test(navigator.userAgent) ? 'Tap to use camera or gallery' : 'Choose file'}
                                            </label>
                                        </div>
                                    </div>
                                </div>

                                {/* Basic Info */}
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                    <div>
                                        <label className="block text-sm font-medium mb-1">Name *</label>
                                        <input
                                            type="text"
                                            value={formData.name}
                                            onChange={(e) => setFormData({...formData, name: e.target.value})}
                                            className="w-full border rounded px-3 py-2"
                                            required
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium mb-1">Brand *</label>
                                        <input
                                            type="text"
                                            value={formData.brand}
                                            onChange={(e) => setFormData({...formData, brand: e.target.value})}
                                            className="w-full border rounded px-3 py-2"
                                            required
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium mb-1">Origin</label>
                                        <input
                                            type="text"
                                            value={formData.origin}
                                            onChange={(e) => setFormData({...formData, origin: e.target.value})}
                                            className="w-full border rounded px-3 py-2"
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium mb-1">Roast Level</label>
                                        <select
                                            value={formData.roastLevel}
                                            onChange={(e) => setFormData({...formData, roastLevel: e.target.value})}
                                            className="w-full border rounded px-3 py-2"
                                        >
                                            {ROAST_LEVELS.map(level => (
                                                <option key={level} value={level}>{level}</option>
                                            ))}
                                        </select>
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium mb-1">Roasting Date</label>
                                        <input
                                            type="date"
                                            value={formData.roastingDate}
                                            onChange={(e) => setFormData({...formData, roastingDate: e.target.value})}
                                            className="w-full border rounded px-3 py-2"
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium mb-1">Grinding Level</label>
                                        <input
                                            type="number"
                                            value={formData.grindingLevel}
                                            onChange={(e) => setFormData({...formData, grindingLevel: e.target.value})}
                                            className="w-full border rounded px-3 py-2"
                                            placeholder="1-10"
                                            min="1"
                                            max="10"
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium mb-1">Price</label>
                                        <input
                                            type="text"
                                            value={formData.price}
                                            onChange={(e) => setFormData({...formData, price: e.target.value})}
                                            className="w-full border rounded px-3 py-2"
                                            placeholder="e.g., $15.99"
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium mb-1">Order Link</label>
                                        <input
                                            type="url"
                                            value={formData.orderLink}
                                            onChange={(e) => setFormData({...formData, orderLink: e.target.value})}
                                            className="w-full border rounded px-3 py-2"
                                            placeholder="https://..."
                                        />
                                    </div>
                                </div>

                                {/* Notes */}
                                <div className="mb-4">
                                    <label className="block text-sm font-medium mb-1">Tasting Notes</label>
                                    <textarea
                                        value={formData.notes}
                                        onChange={(e) => setFormData({...formData, notes: e.target.value})}
                                        className="w-full border rounded px-3 py-2"
                                        rows="3"
                                        placeholder="Describe the flavor profile..."
                                    />
                                </div>

                                {/* Brew Methods */}
                                <div className="mb-4">
                                    <h3 className="text-lg font-semibold mb-2">Brew Methods & Ratings</h3>
                                    
                                    {/* Existing methods */}
                                    {Object.entries(formData.brewMethods).map(([method, ratings]) => (
                                        <div key={method} className="bg-gray-50 p-3 rounded mb-2">
                                            <div className="flex justify-between items-center mb-2">
                                                <span className="font-medium">{method}</span>
                                                <button
                                                    type="button"
                                                    onClick={() => handleRemoveBrewMethod(method)}
                                                    className="text-red-600 hover:text-red-800"
                                                >
                                                    Remove
                                                </button>
                                            </div>
                                            <div className="grid grid-cols-2 gap-2 text-sm">
                                                {RATING_CATEGORIES.map(cat => (
                                                    <div key={cat}>
                                                        <span className="capitalize">{cat}: </span>
                                                        <span className="font-medium">{ratings[cat]}/10</span>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                    ))}
                                    
                                    {/* Add new method */}
                                    <div className="bg-amber-50 p-4 rounded">
                                        <div className="mb-3">
                                            <label className="block text-sm font-medium mb-1">Add Brew Method</label>
                                            <select
                                                value={currentMethod}
                                                onChange={(e) => setCurrentMethod(e.target.value)}
                                                className="w-full border rounded px-3 py-2"
                                            >
                                                {BREW_METHODS.map(method => (
                                                    <option key={method} value={method}>{method}</option>
                                                ))}
                                            </select>
                                        </div>
                                        
                                        {/* Rating sliders */}
                                        {RATING_CATEGORIES.map(category => (
                                            <div key={category} className="mb-3">
                                                <div className="flex justify-between items-center mb-1">
                                                    <label className="text-sm font-medium capitalize">{category}</label>
                                                    <span className="text-sm font-bold">{currentRatings[category]}/10</span>
                                                </div>
                                                <input
                                                    type="range"
                                                    min="1"
                                                    max="10"
                                                    value={currentRatings[category]}
                                                    onChange={(e) => setCurrentRatings({
                                                        ...currentRatings,
                                                        [category]: parseInt(e.target.value)
                                                    })}
                                                    className="slider w-full"
                                                />
                                            </div>
                                        ))}
                                        
                                        <button
                                            type="button"
                                            onClick={handleAddBrewMethod}
                                            className="w-full bg-amber-600 text-white py-2 rounded hover:bg-amber-700 transition"
                                        >
                                            Add {currentMethod} Method
                                        </button>
                                    </div>
                                </div>

                                {/* Form Actions */}
                                <div className="flex gap-2">
                                    <button
                                        type="submit"
                                        className="flex-1 bg-green-600 text-white py-2 px-4 rounded hover:bg-green-700 transition"
                                    >
                                        {coffee ? 'Update Coffee' : 'Save Coffee'}
                                    </button>
                                    <button
                                        type="button"
                                        onClick={onClose}
                                        className="flex-1 bg-gray-600 text-white py-2 px-4 rounded hover:bg-gray-700 transition"
                                    >
                                        Cancel
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            );
        }

        // Compare View Component
        function CompareView({ coffee1, coffee2, onClose }) {
            const [selectedMethod, setSelectedMethod] = useState('French Press');

            const getMethodRatings = (coffee, method) => {
                return coffee.brewMethods && coffee.brewMethods[method] 
                    ? coffee.brewMethods[method] 
                    : null;
            };

            const availableMethods = [...new Set([
                ...Object.keys(coffee1.brewMethods || {}),
                ...Object.keys(coffee2.brewMethods || {})
            ])];

            return (
                <div className="bg-white rounded-lg shadow-lg p-6 mb-6">
                    <div className="flex justify-between items-center mb-4">
                        <h2 className="text-2xl font-bold">Coffee Comparison</h2>
                        <button
                            onClick={onClose}
                            className="text-gray-500 hover:text-gray-700"
                        >
                            ✕
                        </button>
                    </div>

                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                        {/* Coffee 1 */}
                        <div className="text-center">
                            <img 
                                src={coffee1.imageUrl || 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgdmlld0JveD0iMCAwIDIwMCAyMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIyMDAiIGhlaWdodD0iMjAwIiBmaWxsPSIjRTVFN0VCIi8+Cjx0ZXh0IHg9IjEwMCIgeT0iMTAwIiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iNjAiIGZpbGw9IiM5Q0EzQUYiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGRvbWluYW50LWJhc2VsaW5lPSJtaWRkbGUiPuKYlTwvdGV4dD4KPC9zdmc+'} 
                                alt={coffee1.name}
                                className="w-32 h-32 object-cover rounded-lg mx-auto mb-3"
                            />
                            <h3 className="text-lg font-semibold">{coffee1.name}</h3>
                            <p className="text-gray-600">{coffee1.brand}</p>
                            <p className="text-sm text-gray-500">{coffee1.origin}</p>
                        </div>

                        {/* Coffee 2 */}
                        <div className="text-center">
                            <img 
                                src={coffee2.imageUrl || 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgdmlld0JveD0iMCAwIDIwMCAyMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIyMDAiIGhlaWdodD0iMjAwIiBmaWxsPSIjRTVFN0VCIi8+Cjx0ZXh0IHg9IjEwMCIgeT0iMTAwIiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iNjAiIGZpbGw9IiM5Q0EzQUYiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGRvbWluYW50LWJhc2VsaW5lPSJtaWRkbGUiPuKYlTwvdGV4dD4KPC9zdmc+'} 
                                alt={coffee2.name}
                                className="w-32 h-32 object-cover rounded-lg mx-auto mb-3"
                            />
                            <h3 className="text-lg font-semibold">{coffee2.name}</h3>
                            <p className="text-gray-600">{coffee2.brand}</p>
                            <p className="text-sm text-gray-500">{coffee2.origin}</p>
                        </div>
                    </div>

                    {/* Method Selection */}
                    <div className="mt-6 mb-4">
                        <label className="block text-sm font-medium mb-2">Compare Brew Method:</label>
                        <select
                            value={selectedMethod}
                            onChange={(e) => setSelectedMethod(e.target.value)}
                            className="w-full border rounded px-3 py-2"
                        >
                            {availableMethods.map(method => (
                                <option key={method} value={method}>{method}</option>
                            ))}
                        </select>
                    </div>

                    {/* Ratings Comparison */}
                    <div className="mt-6">
                        <h4 className="text-lg font-semibold mb-4">Ratings Comparison - {selectedMethod}</h4>
                        <div className="space-y-3">
                            {RATING_CATEGORIES.map(category => {
                                const rating1 = getMethodRatings(coffee1, selectedMethod);
                                const rating2 = getMethodRatings(coffee2, selectedMethod);
                                const value1 = rating1 ? rating1[category] || 0 : 0;
                                const value2 = rating2 ? rating2[category] || 0 : 0;

                                return (
                                    <div key={category} className="grid grid-cols-4 gap-4 items-center">
                                        <div className="text-sm font-medium capitalize">{category}</div>
                                        <div className="text-center">
                                            <div className={`font-bold ${value1 > value2 ? 'text-green-600' : value1 < value2 ? 'text-red-600' : ''}`}>
                                                {value1}/10
                                            </div>
                                            {!rating1 && <span className="text-xs text-gray-500">No data</span>}
                                        </div>
                                        <div className="relative">
                                            <div className="absolute inset-0 flex items-center">
                                                <div className="w-full h-2 bg-gray-200 rounded">
                                                    <div 
                                                        className="h-full bg-amber-600 rounded"
                                                        style={{width: `${(Math.abs(value1 - value2) / 10) * 100}%`}}
                                                    />
                                                </div>
                                            </div>
                                        </div>
                                        <div className="text-center">
                                            <div className={`font-bold ${value2 > value1 ? 'text-green-600' : value2 < value1 ? 'text-red-600' : ''}`}>
                                                {value2}/10
                                            </div>
                                            {!rating2 && <span className="text-xs text-gray-500">No data</span>}
                                        </div>
                                    </div>
                                );
                            })}
                        </div>
                    </div>

                    {/* Details Comparison */}
                    <div className="mt-6 grid grid-cols-2 gap-6">
                        <div>
                            <h4 className="font-semibold mb-2">Details - {coffee1.name}</h4>
                            <div className="text-sm space-y-1">
                                <p><span className="font-medium">Roast:</span> {coffee1.roastLevel}</p>
                                <p><span className="font-medium">Roasting Date:</span> {coffee1.roastingDate || 'N/A'}</p>
                                <p><span className="font-medium">Grinding Level:</span> {coffee1.grindingLevel || 'N/A'}</p>
                                <p><span className="font-medium">Price:</span> {coffee1.price || 'N/A'}</p>
                            </div>
                        </div>
                        <div>
                            <h4 className="font-semibold mb-2">Details - {coffee2.name}</h4>
                            <div className="text-sm space-y-1">
                                <p><span className="font-medium">Roast:</span> {coffee2.roastLevel}</p>
                                <p><span className="font-medium">Roasting Date:</span> {coffee2.roastingDate || 'N/A'}</p>
                                <p><span className="font-medium">Grinding Level:</span> {coffee2.grindingLevel || 'N/A'}</p>
                                <p><span className="font-medium">Price:</span> {coffee2.price || 'N/A'}</p>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        // Render the app
        ReactDOM.render(<CoffeeTrackerApp />, document.getElementById('root'));
    </script>
</body>
</html>
